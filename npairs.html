<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Match Valid Pairs</title>
<link rel="manifest" href="/npairs_manifest.json">
<style>
    body {
        font-family: Arial, sans-serif, bold;
	color: cyan;
        text-align: center;
	background-color: black;
    }
    .container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }
    .column {
        padding: 1px;
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 0px solid lightyellow;
	border-radius: 8px; /* Rounded corners */
    }
    .box {
        margin: 3px;
        padding: 3px 3px;
        border: 1px solid #ccc;
	border-radius: 8px; /* Rounded corners */
        width: 120px; /* Adjust width as needed */
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: opacity 2.5s ease, background-color 0.35s ease; /* Smooth transition */
    }
    .on {
        background-color: darkgray; /* Change to desired 'on' color */
    }
    .correct {
        background-color: green; /* Color for correct pair */
        pointer-events: none;
    }
    .incorrect {
        background-color: red; /* Color for incorrect pair */
        transition: background-color 0.2s ease; /* Smooth transition */
    }
    .invisible {
        opacity: 0;
        background-color: lightgreen; /* Color for correct pair */
        pointer-events: none;
    }
</style>
</head>
<body>
    <div class="container">
        <div class="column" id="leftColumn"></div>
        <div class="column" id="rightColumn"></div>
    </div>
    <p>Points: <span id="points">0</span>
       Errors: <span id="errors">0</span></p>
    <p>LeftArr: <span id="leftArr">0</span>
       RightArr: <span id="rightArr">0</span></p>

    <script src="wl.js"></script>

    <script>
        /* Define your pairs of symbols
	const pairs = [
	    { key: 'a', value: 'A' },
	    { key: 'b', value: 'B' },
	    { key: 'c', value: 'C' },
	    { key: 'd', value: 'D' },
	    { key: 'e', value: 'E' },
	    { key: 'f', value: 'F' },
	    { key: 'g', value: 'G' },
	    { key: 'h', value: 'H' },
	    { key: 'i', value: 'I' },
	    { key: 'j', value: 'J' },
	    { key: 'k', value: 'K' },
	    { key: 'l', value: 'L' },
	    { key: 'm', value: 'M' },
	    { key: 'n', value: 'N' },
	    { key: 'o', value: 'O' },
	    { key: 'p', value: 'P' },
	    { key: 'q', value: 'Q' },
	    { key: 'r', value: 'R' },
	    { key: 's', value: 'S' },
	    { key: 't', value: 'T' },
	    { key: 'u', value: 'U' },
	    { key: 'v', value: 'V' },
	    { key: 'w', value: 'W' },
	    { key: 'x', value: 'X' }
	];
    */

	const wordRows = 6; // how many rows of words to display on the page
	let selectedLeftBox = null; // Track currently selected box in the left column
	let selectedRightBox = null; // Track currently selected box in the right column
        let points = 0; // Track user points
        let errors = 0; // Track user errors
        let correctPairsCount = 0; // Track count of correctly guessed pairs

        let leftInvisibleBoxes = []; // Array to store invisible left boxes
        let rightInvisibleBoxes = []; // Array to store invisible right boxes

        // Function to shuffle array randomly
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // Function to handle click on a box
        function boxClickHandler(column, boxElement) {
            const isSelected = boxElement.classList.contains('on');

            // Reset previously selected box in the same column
            if (column === 'left' && selectedLeftBox !== null) {
                selectedLeftBox.classList.remove('on');
                selectedLeftBox = null;
            } else if (column === 'right' && selectedRightBox !== null) {
                selectedRightBox.classList.remove('on');
                selectedRightBox = null;
            }

            // Toggle current box
            if (isSelected) {
                return;
            }
            boxElement.classList.add('on');
            if (column === 'left') {
                selectedLeftBox = boxElement;
            } else if (column === 'right') {
                selectedRightBox = boxElement;
            }

            // We need both boxes selected to do further processing
            if (selectedLeftBox === null || selectedRightBox === null) {
                return;
            }

            // Check if selected pair is correct
            const isCorrectPair = selectedLeftBox.hiddenValue == selectedRightBox.hiddenValue;
            selectedLeftBox.classList.remove('on');
            selectedRightBox.classList.remove('on');

            if (!isCorrectPair) {
                errors++;
                document.getElementById('errors').textContent = errors;
                selectedLeftBox.classList.add('incorrect');
                selectedRightBox.classList.add('incorrect');


                // Reset boxes if not correct, note that if you are too quick to select another item at this point,
	        // the timeout will get cancelled
                setTimeout(() => {
	            selectedLeftBox.classList.remove('incorrect');
                    selectedRightBox.classList.remove('incorrect');
                    selectedLeftBox = null;
                    selectedRightBox = null;
                }, 100);
                return;
            }

            // Increment points
            points++;
            document.getElementById('points').textContent = points;

            // Mark boxes as correct
            selectedLeftBox.classList.add('correct');
            selectedRightBox.classList.add('correct');

            // Make correct pairs invisible
            setTimeout(() => {
                selectedLeftBox.classList.add('invisible');
                selectedRightBox.classList.add('invisible');
                selectedLeftBox.classList.remove('correct');
                selectedRightBox.classList.remove('correct');
                selectedLeftBox = null;
                selectedRightBox = null;
            }, 200);

            // Check if 3 or more correct pairs have been guessed
            if (leftInvisibleBoxes.length >= 2) {
                pickNewPairAndDisplay();
                pickNewPairAndDisplay();
            }

            // Append to invisible boxes arrays
            leftInvisibleBoxes.push(selectedLeftBox);
            rightInvisibleBoxes.push(selectedRightBox);
            document.getElementById('leftArr').textContent = leftInvisibleBoxes.length;
            document.getElementById('rightArr').textContent = rightInvisibleBoxes.length;
        }

        function pickNewPairAndDisplay() {
            // Pick a new pair randomly
            const idx = Math.floor(Math.random() * pairs.length);
            const newPair = pairs[idx];

            // Randomly select boxes from invisible boxes arrays
            const leftBoxIndex = Math.floor(Math.random() * leftInvisibleBoxes.length);
            const rightBoxIndex = Math.floor(Math.random() * rightInvisibleBoxes.length);

            // Set new pair in randomly selected boxes
            leftInvisibleBoxes[leftBoxIndex].textContent = newPair.key;
            leftInvisibleBoxes[leftBoxIndex].hiddenValue = idx;
            rightInvisibleBoxes[rightBoxIndex].textContent = newPair.value;
            rightInvisibleBoxes[rightBoxIndex].hiddenValue = idx;

            // Make these boxes visible and remove from arrays
            leftInvisibleBoxes[leftBoxIndex].classList.remove('invisible');
            rightInvisibleBoxes[rightBoxIndex].classList.remove('invisible');

            leftInvisibleBoxes.splice(leftBoxIndex, 1);
            rightInvisibleBoxes.splice(rightBoxIndex, 1);
        }

        // Function to display pairs in two columns with randomized order
        function displayPairs() {
            // take wordRows random pairs
            let selectedPairs = {};
            let shuffledLeft = [];
            let shuffledRight = [];
            let prevIdx = -1;
            for (let i = 0; i < wordRows; i++) {
                //console.log(selectedPairs); // debug print the pairs
                // Pick a new pair randomly
                const idx = Math.floor(Math.random() * pairs.length);
                if (idx == prevIdx)
                    continue;
                selectedPairs[idx] = pairs[idx];
                prevIdx = idx;
                shuffledLeft.push(idx);
                shuffledRight.push(idx);
            }

            // Shuffle keys and values separately
            shuffledLeft = shuffleArray(shuffledLeft);
            shuffledRight = shuffleArray(shuffledRight);
            // Get left and right column elements
            const leftColumn = document.getElementById('leftColumn');
            const rightColumn = document.getElementById('rightColumn');

            // Clear previous content
            leftColumn.innerHTML = '';
            rightColumn.innerHTML = '';

            // Display pairs in two columns with randomized order
            for (let i = 0; i < wordRows; i++) {
                const boxLeft = document.createElement('div');
                boxLeft.classList.add('box');
                pair = selectedPairs[shuffledLeft[i]];
                boxLeft.textContent = pair.key;
                boxLeft.addEventListener('click', () => boxClickHandler('left', boxLeft));
                boxLeft.hiddenValue = shuffledLeft[i];
                leftColumn.appendChild(boxLeft);

                pair = selectedPairs[shuffledRight[i]];
                const boxRight = document.createElement('div');
                boxRight.classList.add('box');
                boxRight.textContent = pair.value;
                boxRight.addEventListener('click', () => boxClickHandler('right', boxRight));
                boxRight.hiddenValue = shuffledRight[i];
                rightColumn.appendChild(boxRight);
            }
        }

        // Call displayPairs function when the page loads
        window.onload = () => {
            displayPairs(); // Display initial pairs
        };
    </script>
</body>
</html>
